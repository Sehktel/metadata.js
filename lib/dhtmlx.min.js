/*!
 Product Name: dhtmlxSuite
 Version: 4.6
 Edition: Standard
 License: content of this file is covered by GPL. Usage outside GPL terms is prohibited. To obtain Commercial or Enterprise license contact sales@dhtmlx.com
 Copyright UAB Dinamenta http://www.dhtmlx.com
 */
function eXcell_calck(cell){function calcX(left,top,onReturnSub,val){function out_click(t){t.target!=that.onReturnSub.cell&&-1==t.path.indexOf(that.topNod)&&(that.removeSelf(),that.onReturnSub.grid.editStop(!1))}this.top=top||0,this.left=left||0,this.onReturnSub=onReturnSub||null,this.operandA=0,this.operandB=0,this.operatorA="",this.state=0,this.dotState=0;var that=this;if(onReturnSub.grid._aplNFb||document.addEventListener("click",out_click,!1),this.calckGo=function(){return Math.round(1e3*eval((this.operandA||"0")+"*1"+this.operatorA+this.operandB+"*1"))/1e3},this.isNumeric=function(t){return-1==t.search(/[^1234567890]/gi)},this.isOperation=function(t){return-1==t.search(/[^\+\*\-\/]/gi)},this.onCalcKey=function(t){var e=this.innerHTML,a=that.inputZone;0!=that.state&&2!=that.state||!that.isNumeric(e)?(t||event).preventDefault():(t||event)instanceof KeyboardEvent||((t||event).preventDefault(),"0"!=a.value?a.selectionStart==a.selectionEnd?a.value+=e:a.value=a.value.substr(0,a.selectionStart)+e+a.value.substr(a.selectionEnd):a.value=e),0!=that.state&&2!=that.state||"."!=e||0!=that.dotState||(that.dotState=1,a.value+=e),"±"==e&&(a.value=-1*a.value,that.state=0),0==that.state&&that.isOperation(e)&&(that.operatorA=e,that.operandA=a.value,that.state=1),2==that.state&&that.isOperation(e)&&(that.operandB=a.value,a.value=that.calckGo(),that.operatorA=e,that.operandA=a.value,that.state=1),2==that.state&&"="==e&&(that.operandB=a.value,a.value=that.calckGo(),that.operatorA=e,that.operandA=a.value,that.state=3),1==that.state&&that.isNumeric(e)&&(a.value=e,that.state=2,that.dotState=0),3==that.state&&that.isNumeric(e)&&(a.value=e,that.state=0),3==that.state&&that.isOperation(e)&&(that.operatorA=e,that.operandA=a.value,that.state=1),"C"==e&&(a.value=0,1==that.state&&(that.state=2),that.dotState=0),"π"==e&&(a.value=Math.PI,1==that.state&&(that.state=2),that.dotState=0),"Off"==e?(a.value=that.old_value,that.removeSelf()):a.focus(),(t||event)&&((t||event).cancelBubble=!0)},this.sendResult=function(){if(2==that.state){var t=that.inputZone;that.operandB=t.value,t.value=that.calckGo(),that.operatorA=e,that.operandA=t.value,that.state=3}var e=that.inputZone.value;that.onReturnSub.cell&&void 0!=that.onReturnSub.cell.value&&(that.onReturnSub.cell.value=e),that.removeSelf(),that.onReturnSub.grid.editStop(!1)},this.removeSelf=function(){this.topNod.parentNode&&this.topNod.parentNode.removeChild(this.topNod),document.removeEventListener("click",out_click)},this.keyDown=function(){this.className="calcPressed"},this.keyUp=function(){this.className="calcButton"},this.init_table=function(){var t=this.topNod.childNodes[0];if(t&&"TABLE"==t.tagName){for(var e=t.childNodes[0].childNodes,a=1;a<e.length;a++)for(var l=0;l<e[a].childNodes.length;l++)e[a].childNodes[l].onclick=this.onCalcKey,e[a].childNodes[l].onmousedown=this.keyDown,e[a].childNodes[l].onmouseout=this.keyUp,e[a].childNodes[l].onmouseup=this.keyUp;this.inputZone=this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0],this.onReturnSub?(this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[1].onclick=this.sendResult,this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[1].calk=this):this.topNod.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[1].innerHTML="",this.inputZone.onkeydown=function(t){function a(e){if(!e)return e;that.keyDown.call(e,t),that.onCalcKey.call(e,t),setTimeout(function(){that.keyUp.call(e,t)},60)}var l=t.keyCode;return t.cancelBubble=!0,13==l||9==l?(that.sendResult.call({calk:that}),a(!1)):27==l?(rZone.value=that.old_value,that.removeSelf(),a(!1)):188==l||190==l||191==l||110==l?a(e[5].childNodes[1]):109==l||189==l?a(e[4].childNodes[3]):111==l?a(e[1].childNodes[3]):106==l?a(e[2].childNodes[3]):107==l||187==l?a(e[3].childNodes[3]):96==l||48==l?a(e[5].childNodes[0]):97==l||49==l?a(e[4].childNodes[0]):98==l||50==l?a(e[4].childNodes[1]):99==l||51==l?a(e[4].childNodes[2]):100==l||52==l?a(e[3].childNodes[0]):101==l||53==l?a(e[3].childNodes[1]):102==l||54==l?a(e[3].childNodes[2]):103==l||55==l?a(e[2].childNodes[0]):104==l||56==l?a(e[2].childNodes[1]):105==l||57==l?a(e[2].childNodes[2]):8==l||46==l||l>=16&&l<=18||l>=35&&l<=40||l>=96&&l<=105||l>=112&&l<=123?void 0:a(!1)},"desktop"!=$p.job_prm.device_type&&(this.inputZone.readOnly=!0),that.inputZone.focus()}},this.drawSelf=function(){var t=document.createElement("div");t.className="calcTable",t.style.position="absolute",t.style.top=this.top+"px",t.style.left=this.left+"px",t.innerHTML="<table cellspacing='0' id='calc_01' class='calcTable'><tr><td colspan='4' style='padding: 0px;'><table cellpadding='1' cellspacing='0' width='100%'><tr><td width='100%' style='overflow:hidden; padding: 0px;'><input type='search' class='calcInput' value='0' align='right'></td><td class='calkSubmit'>Ok</td></tr></table></td></tr><tr><td class='calcButton' width='25%'>Off</td><td class='calcButton' width='25%'>C</td><td class='calcButton' width='25%'>π</td><td class='calcButton' width='25%'>/</td></tr><tr><td class='calcButton'>7</td><td class='calcButton'>8</td><td class='calcButton'>9</td><td class='calcButton'>*</td></tr><tr><td class='calcButton'>4</td><td class='calcButton'>5</td><td class='calcButton'>6</td><td class='calcButton'>+</td></tr><tr><td class='calcButton'>1</td><td class='calcButton'>2</td><td class='calcButton'>3</td><td class='calcButton'>-</td></tr><tr><td class='calcButton'>0</td><td class='calcButton'>.</td><td class='calcButton' style='font-family: Arial, Helvetica; font-size: 12pt;'>±</td><td class='calcButton'>=</td></tr></table>",t.onclick=function(t){(t||event).cancelBubble=!0},document.body.appendChild(t),this.topNod=t},this.drawSelf(),this.init_table(),val){var rZone=this.inputZone;rZone.value=1*val,this.operandA=1*val,rZone.select(),this.state=0,this.dotState=this.operandA==Math.round(this.operandA)?0:1}return this}try{this.cell=cell,this.grid=this.cell.parentNode.grid}catch(t){}this.edit=function(){this.val=this.getValue();var t=this.grid.getPosition(this.cell);this.obj=new calcX(t[0],t[1],this,this.val),this.obj.old_value=this.val},this.getValue=function(){return this.grid._aplNFb?this.grid._aplNFb(this.cell.innerHTML.toString()._dhx_trim(),this.cell._cellIndex):this.cell.value},this.detach=function(){return this.obj&&(this.setValue(this.obj.inputZone.value),this.obj.removeSelf()),this.obj=null,this.val!=this.getValue()}}window.eXcell||(window.eXcell=function(){}),eXcell_calck.prototype=new eXcell,eXcell_calck.prototype.setValue=function(t){t=t&&""!=t.toString()._dhx_trim()?parseFloat(t):"0",this.grid._aplNF&&this.setCValue(this.grid._aplNF(t,this.cell._cellIndex),t)};